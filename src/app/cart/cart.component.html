<div class="container" style="max-width: 1200px; margin: 0 auto;">
  <div class="row align-items-center py-4 mb-4 bg-light rounded shadow">
    <div class="col text-center">
      <h1 class="display-5"><span class="text-primary">Carrito de Compras</span></h1>
      <p class="lead">Revisa tus libros seleccionados y finaliza tu compra f√°cilmente.</p>
    </div>
  </div>
  <div class="row mb-4">
    <div class="col-md-8 mx-auto">
      <p>Estos son los libros que has seleccionado para comprar. Puedes revisar los detalles, eliminar alg√∫n libro o
        finalizar tu compra.</p>
      <p>Recuerda que puedes agregar m√°s libros desde la p√°gina de b√∫squeda. ¬°Disfruta de la mejor selecci√≥n de
        literatura!</p>
    </div>
  </div>
  <div class="row">
    <ng-container *ngIf="cartItems$ | async as cartItems">
      @for (item of cartItems; track item.book.id) {
        <div class="col-md-4 mb-4">
          <div class="card h-100">
            <img ngSrc="{{ item.book.imagen }}" width="320" height="200" alt="Libro carrito" class="card-img-top"
                 style="height: 200px; object-fit: contain; background: #f8f9fa;">
            <div class="card-body">
              <h5 class="card-title">{{ item.book.titulo }}</h5>
              <p class="card-text mb-1"><strong>Autor:</strong> {{ item.book.autor }}</p>
              <p class="card-text mb-1"><strong>A√±o:</strong> {{ item.book['a√±o'] }} |
                <strong>Categor√≠a:</strong> {{ item.book.categoria }}</p>
              <p class="card-text mb-1"><strong>Cantidad:</strong> {{ item.quantity }}</p>
              <button class="btn btn-danger w-100" (click)="removeFromCart(item.book.id)"><span class="me-2">üóëÔ∏è</span>Eliminar</button>
            </div>
          </div>
        </div>
      }
      @if (cartItems.length === 0) {
        <div class="col-12">
          <div class="alert alert-warning text-center">No hay libros en el carrito.</div>
        </div>
      }
    </ng-container>
  </div>
  <div class="row justify-content-end mb-4">
    <div class="col-md-4">
      <div class="d-flex justify-content-between align-items-center border rounded p-3 mb-2">
        <span class="fw-bold">Total:</span>
        <span class="fs-5">${{ cartTotal$ | async | number:'1.2-2' }}</span>
      </div>
      <button class="btn btn-primary w-100" (click)="openPaymentDialog()">Finalizar compra</button>
    </div>
  </div>
  <div class="row">
    <div class="col-12 d-flex justify-content-center">
      <div class="alert alert-info d-flex align-items-center justify-content-center"
           style="width: 80vw; max-width: 80vw;">
        <span class="me-2">‚ùì</span>
        <span>¬øTienes dudas sobre el proceso de compra? Nuestro equipo est√° disponible para ayudarte en todo momento.</span>
      </div>
    </div>
  </div>
</div>

<!-- Modal de pago -->
<div class="row">
  @if (showPaymentDialog) {
    <div class="modal d-block" tabindex="-1" role="dialog" aria-modal="true" style="background: rgba(0,0,0,0.4);">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Pago con tarjeta de cr√©dito</h5>
            <button type="button" class="btn-close" aria-label="Cerrar" (click)="closePaymentDialog()"></button>
          </div>
          <form (ngSubmit)="submitPayment()" autocomplete="off">
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Nombre en la tarjeta</label>
                <input type="text" class="form-control" [(ngModel)]="paymentForm.name" name="name" required>
              </div>
              <div class="mb-3">
                <label class="form-label">N√∫mero de tarjeta</label>
                <input type="text" class="form-control" maxlength="19" [(ngModel)]="paymentForm.number" name="number"
                       required placeholder="1234 5678 9012 3456">
              </div>
              <div class="row">
                <div class="col-6 mb-3">
                  <label class="form-label">Expiraci√≥n (MM/AA)</label>
                  <input type="text" class="form-control" maxlength="5" [(ngModel)]="paymentForm.expiry" name="expiry"
                         required placeholder="MM/AA">
                </div>
                <div class="col-6 mb-3">
                  <label class="form-label">CVV</label>
                  <input type="text" class="form-control" maxlength="4" [(ngModel)]="paymentForm.cvv" name="cvv"
                         required placeholder="123">
                </div>
              </div>
              <div class="row">
                @if (paymentError) {
                  <div class="alert alert-danger py-2">{{ paymentError }}</div>
                }
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="closePaymentDialog()">Cancelar</button>
              <button type="submit" class="btn btn-primary">Pagar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  }
</div>
